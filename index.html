// ... (style a HTML zůstává stejné, měníme jen funkci updateData v scriptu)

        async function updateData() {
            try {
                const pRes = await fetch(`https://min-api.cryptocompare.com/data/pricemultifull?fsyms=${assets.join(',')}&tsyms=USD`);
                const pJson = await pRes.json();
                
                // Oprava dotazu: Přidali jsme filtr, aby to tahalo data přesně pro aktuální symboly a timeframe
                const dbRes = await fetch(`${SB_URL}/rest/v1/oracle_signals?timeframe=eq.${selectedTF}`, { 
                    headers: { 
                        'apikey': SB_KEY, 
                        'Authorization': `Bearer ${SB_KEY}` 
                    } 
                });
                const dbData = await dbRes.json();
                const t = texts[lang];

                let html = "";
                for (const sym of assets) {
                    const raw = pJson.RAW[sym].USD;
                    const price = raw.PRICE;
                    
                    // Najdeme data pro konkrétní minci v poli z DB
                    const db = dbData.find(d => d.symbol.toUpperCase() === sym.toUpperCase()) || { verdict: 'HOLD', confidence: 0 };
                    
                    // Pokud v DB nic není, místo 50% tam dáme "no data" nebo 0, aby bylo jasné, že se to nenačetlo
                    const displayConfidence = db.confidence > 0 ? db.confidence : 0;
                    
                    const trade = activeTrades[sym];
                    
                    const histRes = await fetch(`https://min-api.cryptocompare.com/data/v2/histo${curType}?fsym=${sym}&tsym=USD&limit=${curLimit}`);
                    const histJson = await histRes.json();
                    const oldPrice = histJson.Data.Data[0].close;
                    const diffTrend = ((price - oldPrice) / oldPrice) * 100;

                    let vTxt = t.hold;
                    const rv = db.verdict ? db.verdict.toUpperCase() : "HOLD";
                    if (rv.includes("BUY")) vTxt = t.buy; 
                    else if (rv.includes("SELL")) vTxt = t.sell;

                    const pnl = trade ? (trade.type === 'BUY' ? (price - trade.entry) : (trade.entry - price)) : 0;
                    
                    // Barva pro verdikt podle DB
                    let vColor = 'var(--hold)';
                    if (rv.includes("BUY")) vColor = 'var(--buy)';
                    else if (rv.includes("SELL")) vColor = 'var(--sell)';

                    html += `
                    <div class="card" style="border-color: ${trade ? (trade.type==='BUY'?'var(--buy)':'var(--sell)') : '#222'}">
                        <div class="top-sim-row">
                            <div class="sim-btn-box ${trade?.type==='BUY'?'sim-active':''}" onclick="toggleSim('${sym}','BUY',${price})">${t.b}<br><span style="color:${pnl>=0?'var(--buy)':'var(--sell)'}">${trade?pnl.toFixed(4):'--'}</span></div>
                            <span class="coin-name" style="color:#555">${sym === 'M' ? 'MEMECORE' : sym}</span>
                            <div class="sim-btn-box ${trade?.type==='SELL'?'sim-active':''}" onclick="toggleSim('${sym}','SELL',${price})">${t.s}<br><span>${trade?getTimer(trade.start):'--'}</span></div>
                        </div>

                        <span class="coin-price">$${price.toFixed(4)}</span>

                        <div class="rep-btn" onclick="openReport()">${t.rep}</div>

                        <div class="status-row">
                            <div class="indicator" style="color:${diffTrend>=0?'var(--buy)':'var(--sell)'}">${diffTrend>=0?t.up:t.down}<br>${diffTrend.toFixed(2)}%</div>
                            <div class="main-verdict" style="color:${vColor}">${vTxt}<br><span style="font-size:0.5rem; opacity:0.6;">${displayConfidence}% ${t.acc}</span></div>
                            <div class="indicator" style="color:#444">${t.vol}<br>${formatVol(raw.VOLUME24HOURTO)}</div>
                        </div>
                    </div>`;
                }
                document.getElementById('grid').innerHTML = html;
                document.getElementById('m-title').innerText = t.title;
                document.getElementById('clear-btn').innerText = t.clear;
            } catch (e) {
                console.error("Chyba při updatu:", e);
            }
        }
// ... zbytek kódu zůstává stejný
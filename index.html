<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ORACLE TERMINAL | v128.16 GLOBAL-VOLUME-SYNC</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@stellar/stellar-sdk@12.1.0/dist/stellar-sdk.min.js"></script>
    <script src="https://sdk.minepi.com/pi-sdk.js?v=2.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --neon: #00f2ff; --bg: #050505; --panel: #0a0a0a; --buy: #39ff14; --sell: #ff4444; --hold: #ffd700; }
        body { background-color: var(--bg); color: #eee; font-family: sans-serif; margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; }
        #pin-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; color: var(--neon); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 30000; font-family: monospace; }
        .pin-grid { display: grid; grid-template-columns: repeat(3, 80px); gap: 15px; margin-top: 20px; }
        .pin-btn { background: #111; border: 1px solid var(--neon); color: var(--neon); padding: 20px; font-size: 1.5rem; border-radius: 50%; cursor: pointer; transition: 0.2s; width: 75px; height: 75px; }
        #pin-display { font-size: 3rem; letter-spacing: 10px; margin-bottom: 20px; color: #fff; }
        
        /* HLAVIČKA */
        .header-box { width: 100%; max-width: 800px; padding: 10px 0; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #222; margin-bottom: 15px; }
        h1 { color: var(--neon); font-size: 0.75rem; letter-spacing: 2px; margin: 0; text-transform: uppercase; font-weight: 900; display: flex; align-items: center; }
        
        .admin-link { background: none; border: 1px solid var(--neon); color: var(--neon); padding: 6px 12px; border-radius: 4px; text-decoration: none; font-size: 0.75rem; font-weight: 900; transition: 0.3s; }
        .admin-link:hover { background: var(--neon); color: #000; }

        .motor-dot { height: 10px; width: 10px; border-radius: 50%; display: inline-block; margin-left: 8px; vertical-align: middle; }
        .dot-active { background-color: var(--buy); box-shadow: 0 0 10px var(--buy); animation: blink 1.5s infinite; }
        .dot-off { background-color: var(--sell); }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }
        
        /* ŘADA S OVLÁDÁNÍM (ČASY + JAZYK) */
        .control-row { display: flex; justify-content: space-between; align-items: center; width: 100%; max-width: 800px; margin-bottom: 20px; gap: 10px; }
        .time-selector { display: flex; gap: 5px; }
        .time-btn { background: #111; border: 1px solid #444; color: #fff; padding: 8px 10px; border-radius: 6px; font-size: 0.75rem; cursor: pointer; font-weight: 900; }
        .time-btn.active { border-color: var(--neon); color: var(--neon); box-shadow: 0 0 10px rgba(0, 242, 255, 0.4); }
        
        .lang-switch { font-size: 0.7rem; font-weight: 900; cursor: pointer; color: #fff; border: 1px solid #444; padding: 8px 10px; border-radius: 6px; background: #111; min-width: 50px; text-align: center; }

        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; width: 100%; max-width: 800px; position: relative; }
        .card { background: var(--panel); border: 2px solid #333; border-radius: 16px; padding: 12px 8px; display: flex; flex-direction: column; align-items: center; min-height: 230px; justify-content: space-between; position: relative; }
        .top-sim-row { width: 100%; display: flex; justify-content: space-between; align-items: flex-start; }
        .sim-btn-box { background: #111; border: 1px solid #444; color: #fff; padding: 6px 4px; border-radius: 6px; font-size: 0.55rem; font-weight: 900; text-align: center; cursor: pointer; min-width: 65px; line-height: 1.1; }
        .sim-btn-box.sim-active { border-color: var(--buy); color: var(--buy); }
        .rep-btn { background: #111; border: 1px solid #fff; color: #fff; padding: 5px 12px; border-radius: 4px; font-size: 0.6rem; font-weight: 900; margin-bottom: 5px; cursor: pointer; text-transform: uppercase; }
        .coin-name { font-size: 0.9rem; font-weight: 900; color: #fff; text-transform: uppercase; letter-spacing: 1.5px; }
        .coin-price { font-size: 1.45rem; font-weight: 900; color: #fff; font-variant-numeric: tabular-nums; }
        .status-row { display: flex; width: 100%; justify-content: space-between; align-items: center; gap: 4px; }
        .indicator { background: #111; padding: 8px 2px; border-radius: 6px; font-size: 0.55rem; font-weight: 900; flex: 1; text-align: center; line-height: 1.2; border: 1px solid #444; }
        .main-verdict { background: rgba(255,255,255,0.04); padding: 8px 2px; border-radius: 8px; font-weight: 900; font-size: 0.85rem; text-transform: uppercase; flex: 1.6; text-align: center; border: 1px solid #444; }
        
        #reportModal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.98); z-index: 20000; padding: 20px; overflow-y: auto; }
        .bank-header { background: #111; border: 1px solid var(--neon); padding: 15px; border-radius: 12px; text-align: center; }
        .bank-balance { font-size: 1.5rem; font-weight: 900; color: var(--neon); }
        .auto-box { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 12px; margin-top: 20px; border: 1px solid #333; }
        .auto-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; font-size: 0.8rem; font-weight: 900; }
        .bank-input { background: #000; border: 1px solid #444; color: #fff; padding: 5px; width: 60px; text-align: center; font-weight: 900; border-radius: 4px; }
        .unit-btn { background: #222; border: 1px solid #444; color: var(--neon); padding: 2px 6px; border-radius: 4px; cursor: pointer; font-size: 0.6rem; min-width: 45px; }
        .history-item { display: flex; flex-direction: column; padding: 12px; border-bottom: 1px solid #222; font-size: 0.7rem; }
    </style>
</head>
<body>
    <div id="pin-screen">
        <h2 style="letter-spacing: 5px;">ORACLE PŘIHLÁŠENÍ</h2>
        <div id="pin-display">____</div>
        <div class="pin-grid">
            <button class="pin-btn" onclick="press('1')">1</button><button class="pin-btn" onclick="press('2')">2</button><button class="pin-btn" onclick="press('3')">3</button>
            <button class="pin-btn" onclick="press('4')">4</button><button class="pin-btn" onclick="press('5')">5</button><button class="pin-btn" onclick="press('6')">6</button>
            <button class="pin-btn" onclick="press('7')">7</button><button class="pin-btn" onclick="press('8')">8</button><button class="pin-btn" onclick="press('9')">9</button>
            <button class="pin-btn" onclick="clearPin()" style="color:var(--sell)">C</button><button class="pin-btn" onclick="press('0')">0</button><button class="pin-btn" onclick="validatePin()" style="color:var(--buy)">OK</button>
        </div>
    </div>

    <div id="main-content" style="display: none; width: 100%; max-width: 800px;">
        <div class="header-box">
            <h1>ORACLE TERMINAL <span id="motor-status" class="motor-dot dot-off"></span></h1>
            <a href="admin.html" class="admin-link" target="_self">[ ⬌ ADMIN ]</a>
        </div>

        <div class="control-row">
            <div class="time-selector">
                <button class="time-btn" onclick="setTime(this, '1M')">1M</button>
                <button class="time-btn" onclick="setTime(this, '5M')">5M</button>
                <button class="time-btn active" onclick="setTime(this, '15M')">15M</button>
                <button class="time-btn" onclick="setTime(this, '1H')">1H</button>
                <button class="time-btn" onclick="setTime(this, '4H')">4H</button>
            </div>
            <div class="lang-switch" onclick="toggleLang()"><span id="lang-cz">CZ</span>/<span id="lang-en">EN</span></div>
        </div>
        
        <div id="grid" class="grid"></div>
    </div>

    <div id="reportModal">
        <div class="bank-header">
            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                <span style="font-size:0.6rem; color:#aaa;">UČENÍ VERTEX</span>
                <button id="learn-btn" onclick="toggleLearning()" style="background:none; border:1px solid #444; color:#fff; font-size:0.6rem; padding:4px 10px; border-radius:10px; font-weight:900;">UČENÍ: VYP</button>
            </div>
            <div id="bank-val" class="bank-balance">10000.00 USDT</div>
            <div style="margin-top:10px; font-size:0.8rem;">OBCHOD: <input type="number" id="trade-stake" class="bank-input" value="250" oninput="updateStake(this.value)"> USDT</div>
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-top: 12px;">
                <button onclick="closeReport()" style="padding:14px; background:var(--neon); color:#000; border:none; font-weight:900; border-radius:6px; cursor:pointer; font-size:0.75rem;">ZAVŘÍT</button>
                <button onclick="simpleAction('clear')" style="padding:14px; background:#111; color:#fff; border:1px solid #444; font-weight:900; border-radius:6px; cursor:pointer; font-size:0.75rem;">SMAZAT</button>
                <button onclick="simpleAction('reset')" style="padding:14px; background:#111; color:#ff4444; border:1px solid #444; font-weight:900; border-radius:6px; cursor:pointer; font-size:0.75rem;">RESET</button>
            </div>
        </div>
        <div class="auto-box">
            <div class="auto-row"><span>MOTOR:</span><button id="auto-btn" class="unit-btn" onclick="toggleAutopilot()" style="width:80px;">VYP</button></div>
            <div class="auto-row"><span>ZAVŘÍT ZISKY:</span><div style="display:flex; align-items:center; gap:5px;"><button id="cat-btn" class="unit-btn" onclick="toggleCatcher()">VYP</button><input type="number" id="cat-sec" class="bank-input" value="10" style="width:40px;">s NAD <input type="number" id="cat-min" class="bank-input" value="0.08" step="0.01" style="width:50px;">%</div></div>
            <div class="auto-row"><span>STOP LOSS:</span><div style="display:flex; align-items:center; gap:5px;"><button id="sl-unit" class="unit-btn" onclick="toggleUnit('sl')">%</button><input type="checkbox" id="sl-en" onchange="syncAuto()"><input type="number" id="sl-val" class="bank-input" value="2.5" step="0.1" oninput="syncAuto()"></div></div>
            <div class="auto-row"><span>TAKE PROFIT:</span><div style="display:flex; align-items:center; gap:8px;"><button id="tp-unit" class="unit-btn" onclick="toggleUnit('tp')">%</button><input type="checkbox" id="tp-en" onchange="syncAuto()"><input type="number" id="tp-val" class="bank-input" value="5.0" step="0.1" oninput="syncAuto()"></div></div>
        </div>
        <div id="historyList"></div>
    </div>

    <script>
        let pinInput = ""; const MASTER_PIN = "1970";
        const SB_URL = "https://zrbqhhnxshrayctqmncy.supabase.co";
        const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpyYnFoaG54c2hyYXljdHFtbmN5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE2ODE2MjcsImV4cCI6MjA4NzI1NzYyN30.7JA6rGog3TphPqdb3tbHz4D03haXSFWZOXwi2yK_uek";
        let lang = localStorage.getItem('oracle_lang') || 'CZ', selectedTF = '15M';
        const texts = { CZ: { buy: 'KOUPIT', sell: 'PRODAT', hold: 'ČEKEJ', up: 'VZESTUP', down: 'POKLES', b: 'ZISK', rep: 'HISTORIE' }, EN: { buy: 'BUY', sell: 'SELL', hold: 'HOLD', up: 'UP', down: 'DOWN', b: 'PROFIT', rep: 'BANK' } };
        
        let activeTrades = JSON.parse(localStorage.getItem('oracle_trades')) || {}, tradeHistory = JSON.parse(localStorage.getItem('oracle_history')) || [];
        let bank = parseFloat(localStorage.getItem('oracle_bank')) || 10000.00, stake = parseFloat(localStorage.getItem('oracle_stake')) || 250.00;
        let autoSettings = JSON.parse(localStorage.getItem('oracle_auto')) || { slEn: false, slVal: 2.5, slUnit: '%', tpEn: false, tpVal: 5.0, tpUnit: '%', learning: true, autopilot: false, catcher: false, catcherSec: 10, catcherMin: 0.08 };
        let activeAssets = ['BTC', 'ETH', 'PI', 'M']; let lastPrices = {};

        function press(n) { if(pinInput.length < 4) { pinInput += n; updatePin(); } }
        function clearPin() { pinInput = ""; updatePin(); }
        function updatePin() { document.getElementById('pin-display').innerText = "●".repeat(pinInput.length) + "_".repeat(4-pinInput.length); }
        function validatePin() { if(pinInput === MASTER_PIN) { document.getElementById('pin-screen').style.display='none'; document.getElementById('main-content').style.display='block'; initApp(); } else clearPin(); }

        async function initApp() { await forceSyncAssets(); setInterval(forceSyncAssets, 5000); updateData(); setInterval(updateData, 2000); setInterval(profitCatcherLoop, 1000); syncUI(); }

        async function forceSyncAssets() {
            try {
                const res = await fetch(`${SB_URL}/rest/v1/oracle_settings?id=eq.active_assets&select=*`, { headers: {'apikey': SB_KEY, 'Authorization': `Bearer ${SB_KEY}`, 'Cache-Control': 'no-cache'} });
                const data = await res.json();
                if(data.length) {
                    const newAssets = data[0].value;
                    if(JSON.stringify(activeAssets) !== JSON.stringify(newAssets)) {
                        activeAssets = newAssets; document.getElementById('grid').innerHTML = ""; 
                    }
                }
            } catch(e) {}
        }

        async function updateData() {
            try {
                const [resB, resBridge, hRes, sRes] = await Promise.all([
                    fetch("https://api.binance.com/api/v3/ticker/24hr?symbols=[%22BTCUSDT%22,%22ETHUSDT%22,%22SOLUSDT%22,%22BNBUSDT%22,%22XRPUSDT%22,%22ADAUSDT%22,%22DOGEUSDT%22,%22LTCUSDT%22]").then(r=>r.json()).catch(()=>[]),
                    fetch("/api/oracle-bridge").then(r=>r.json()).catch(()=>[]),
                    fetch(`${SB_URL}/rest/v1/oracle_hype?select=*`, { headers: {'apikey': SB_KEY, 'Authorization': `Bearer ${SB_KEY}`} }).then(r=>r.json()),
                    fetch(`${SB_URL}/rest/v1/oracle_signals?select=*&timeframe=eq.${selectedTF}`, { headers: {'apikey': SB_KEY, 'Authorization': `Bearer ${SB_KEY}`} }).then(r=>r.json())
                ]);

                const t = texts[lang]; let finalHtml = "";
                activeAssets.forEach(sym => {
                    const sig = sRes.find(x=>x.symbol === sym) || {verdict:'HOLD', analysis:'...', volume: 0};
                    let p = 0, c = 0, v = "---";
                    const bin = Array.isArray(resB) ? resB.find(x=>x.symbol === sym+"USDT") : null;
                    if(bin) { p = parseFloat(bin.lastPrice); c = parseFloat(bin.priceChangePercent); } 
                    else { const d = resBridge.find(x=>x.id===sym); p = d?.price || 0; c = d?.change24h || 0; }
                    
                    if(sig.volume && sig.volume > 0) { v = (sig.volume / 1e6).toFixed(1) + 'M'; } 
                    else if(bin) { v = (parseFloat(bin.quoteVolume)/1e6).toFixed(1)+'M'; }

                    lastPrices[sym] = p;
                    const hype = hRes.find(x=>x.symbol === sym)?.score || 0;
                    let trade = activeTrades[sym];
                    let pnlVal = 0, pnlPct = 0;
                    if(trade) {
                        pnlPct = (trade.type==='BUY'?(p-trade.entry)/trade.entry:(trade.entry-p)/trade.entry)*100;
                        pnlVal = (pnlPct/100)*stake;
                        if(autoSettings.slEn && !trade.isClosing) {
                            if(autoSettings.slUnit === '%' ? (pnlPct <= -autoSettings.slVal) : (pnlVal <= -autoSettings.slVal)) executeClose(sym, p, trade);
                        }
                        if(autoSettings.tpEn && !trade.isClosing) {
                            if(autoSettings.tpUnit === '%' ? (pnlPct >= autoSettings.tpVal) : (pnlVal >= autoSettings.tpVal)) executeClose(sym, p, trade);
                        }
                    } else if(autoSettings.autopilot && !trade && hype >= 65) {
                        if(sig.verdict.includes("BUY")) toggleSim(sym, 'BUY', p, true, hype, sig.verdict);
                        else if(sig.verdict.includes("SELL")) toggleSim(sym, 'SELL', p, true, hype, sig.verdict);
                    }

                    let lB = `<div class="sim-btn-box" onclick="toggleSim('${sym}','BUY',${p},false,${hype},'${sig.verdict}')">${t.buy}</div>`;
                    let rB = `<div class="sim-btn-box" onclick="toggleSim('${sym}','SELL',${p},false,${hype},'${sig.verdict}')">${t.sell}</div>`;
                    if(trade?.type==='BUY') { 
                        let color = pnlVal >= 0 ? 'var(--buy)' : 'var(--sell)';
                        lB = `<div class="sim-btn-box sim-active" style="color:${color}; border-color:${color}" onclick="executeClose('${sym}',${p},activeTrades['${sym}'])">${t.b}<br>${pnlVal.toFixed(2)}$</div>`; 
                        rB = `<div class="sim-btn-box">${getTimer(trade.start)}</div>`; 
                    }
                    if(trade?.type==='SELL') { 
                        let color = pnlVal >= 0 ? 'var(--buy)' : 'var(--sell)';
                        rB = `<div class="sim-btn-box sim-active" style="color:${color}; border-color:${color}" onclick="executeClose('${sym}',${p},activeTrades['${sym}'])">${t.b}<br>${pnlVal.toFixed(2)}$</div>`; 
                        lB = `<div class="sim-btn-box">${getTimer(trade.start)}</div>`; 
                    }

                    let statusColor = c >= 0 ? 'var(--buy)' : 'var(--sell)';
                    let cardColor = trade ? (pnlVal >= 0 ? 'var(--buy)' : 'var(--sell)') : '#333';

                    finalHtml += `<div class="card" style="border-color:${cardColor}">
                        <div class="top-sim-row">${lB} ${rB}</div>
                        <span class="coin-name">${sym}</span>
                        <span class="coin-price" style="color:${statusColor}">$${p.toLocaleString(undefined,{minimumFractionDigits:sym==='BTC'?2:4})}</span>
                        <div class="rep-btn" onclick="openReport()">[ ${t.rep} ]</div>
                        <div class="status-row">
                            <div class="indicator" style="color:${statusColor}">${c>=0?t.up:t.down}<br>${c.toFixed(2)}%</div>
                            <div class="main-verdict" style="color:var(--${sig.verdict.includes('BUY')?'buy':(sig.verdict.includes('SELL')?'sell':'hold')})">${sig.verdict.includes('BUY')?t.buy:(sig.verdict.includes('SELL')?t.sell:t.hold)}<br><span style="font-size:0.5rem;color:#fff;">${hype}% HYPE</span></div>
                            <div class="indicator" style="color:#fff">VOL<br>${v}</div>
                        </div></div>`;
                });
                document.getElementById('grid').innerHTML = finalHtml;
                document.getElementById('bank-val').innerText = bank.toFixed(2) + " USDT";
            } catch(e) {}
        }

        async function executeClose(sym, price, trade) {
            if(trade.isClosing) return; trade.isClosing = true;
            const pnl = (trade.type==='BUY'?(price-trade.entry)/trade.entry:(trade.entry-price)/trade.entry)*stake;
            bank += (stake + pnl);
            if(autoSettings.learning) {
                try { await fetch(`${SB_URL}/rest/v1/oracle_trade_history`, { method:'POST', headers:{'apikey':SB_KEY,'Authorization':`Bearer ${SB_KEY}`,'Content-Type':'application/json'}, body:JSON.stringify({symbol:sym, type:trade.type, pnl:pnl, timeframe:selectedTF, is_auto:trade.isAuto}) }); } catch(e){}
            }
            tradeHistory.unshift({ sym, pnl, time: new Date().toLocaleTimeString().slice(0,5), duration: getTimer(trade.start), hype: trade.hype, tf: selectedTF, isAuto: trade.isAuto });
            localStorage.setItem('oracle_bank', bank); localStorage.setItem('oracle_history', JSON.stringify(tradeHistory));
            delete activeTrades[sym]; localStorage.setItem('oracle_trades', JSON.stringify(activeTrades));
            updateData();
        }

        function profitCatcherLoop() {
            if(!autoSettings.catcher) return;
            for(const sym in activeTrades) {
                const t = activeTrades[sym]; if(t.isClosing) continue;
                if(Math.floor((Date.now()-t.start)/1000) >= autoSettings.catcherSec) {
                    const p = lastPrices[sym];
                    const pnlPct = (t.type==='BUY'?(p-t.entry)/t.entry:(t.entry-p)/t.entry)*100;
                    if(pnlPct >= autoSettings.catcherMin) executeClose(sym, p, t);
                }
            }
        }

        function toggleSim(sym, type, p, isAuto=false, hype=0, verdict='') {
            if(!activeTrades[sym] && bank >= stake) {
                bank -= stake; activeTrades[sym] = { type, entry: p, start: Date.now(), isAuto, hype, verdict };
                localStorage.setItem('oracle_bank', bank); localStorage.setItem('oracle_trades', JSON.stringify(activeTrades));
                updateData();
            }
        }

        function getTimer(s) { let d = Math.floor((Date.now()-s)/1000); return `${Math.floor(d/60).toString().padStart(2,'0')}:${(d%60).toString().padStart(2,'0')}`; }
        function syncAuto() { 
            autoSettings.slEn = document.getElementById('sl-en').checked;
            autoSettings.slVal = parseFloat(document.getElementById('sl-val').value);
            autoSettings.tpEn = document.getElementById('tp-en').checked;
            autoSettings.tpVal = parseFloat(document.getElementById('tp-val').value);
            autoSettings.catcherSec = parseInt(document.getElementById('cat-sec').value);
            autoSettings.catcherMin = parseFloat(document.getElementById('cat-min').value);
            localStorage.setItem('oracle_auto', JSON.stringify(autoSettings)); 
        }
        function toggleAutopilot() { autoSettings.autopilot = !autoSettings.autopilot; syncAuto(); syncUI(); }
        function toggleLearning() { autoSettings.learning = !autoSettings.learning; syncAuto(); syncUI(); }
        function toggleCatcher() { autoSettings.catcher = !autoSettings.catcher; syncAuto(); syncUI(); }
        function toggleUnit(type) { if(type==='sl') autoSettings.slUnit = autoSettings.slUnit==='%'?'USDT':'%'; else autoSettings.tpUnit = autoSettings.tpUnit==='%'?'USDT':'%'; syncAuto(); syncUI(); }
        function syncUI() {
            document.getElementById('motor-status').className = autoSettings.autopilot ? "motor-dot dot-active" : "motor-dot dot-off";
            const btnA = document.getElementById('auto-btn'); btnA.innerText = autoSettings.autopilot ? "ZAP" : "VYP"; btnA.style.borderColor = autoSettings.autopilot ? 'var(--buy)' : '#444'; btnA.style.color = autoSettings.autopilot ? 'var(--buy)' : '#fff';
            const btnL = document.getElementById('learn-btn'); btnL.innerText = autoSettings.learning ? "UČENÍ: ZAP" : "UČENÍ: VYP"; btnL.style.borderColor = autoSettings.learning ? 'var(--buy)' : '#444'; btnL.style.color = autoSettings.learning ? 'var(--buy)' : '#fff';
            const btnC = document.getElementById('cat-btn'); btnC.innerText = autoSettings.catcher ? "ZAP" : "VYP"; btnC.style.borderColor = autoSettings.catcher ? 'var(--buy)' : '#444'; btnC.style.color = autoSettings.catcher ? 'var(--buy)' : '#fff';
            document.getElementById('sl-unit').innerText = autoSettings.slUnit;
            document.getElementById('tp-unit').innerText = autoSettings.tpUnit;
            document.getElementById('sl-en').checked = autoSettings.slEn;
            document.getElementById('tp-en').checked = autoSettings.tpEn;
        }
        function setTime(btn, label) { document.querySelectorAll('.time-btn').forEach(b=>b.classList.remove('active')); btn.classList.add('active'); selectedTF = label; updateData(); }
        function toggleLang() { 
            lang = (lang === 'CZ') ? 'EN' : 'CZ'; 
            localStorage.setItem('oracle_lang', lang); 
            document.getElementById('lang-cz').style.color = (lang === 'CZ') ? 'var(--neon)' : '#fff';
            document.getElementById('lang-en').style.color = (lang === 'EN') ? 'var(--neon)' : '#fff';
            updateData(); 
        }
        function updateStake(v) { stake = parseFloat(v); localStorage.setItem('oracle_stake', stake); }
        function openReport() { 
            const t = texts[lang];
            document.getElementById('historyList').innerHTML = tradeHistory.slice(0,10).map(h => `<div class="history-item"><div style="display:flex; justify-content:space-between;"><span>${h.time} <b>${h.sym}</b> ${h.isAuto?'⚙️':''}</span><span style="color:${h.pnl>=0?'var(--buy)':'var(--sell)'}">${h.pnl.toFixed(2)} USDT</span></div><div style="font-size:0.55rem; color:#666;">TF: ${h.tf} | ČAS: ${h.duration} | HYPE: ${h.hype}%</div></div>`).join('');
            document.getElementById('reportModal').style.display = 'block'; 
        }
        function closeReport() { document.getElementById('reportModal').style.display = 'none'; }
        function simpleAction(t) { if(confirm("OK?")) { if(t==='reset') { localStorage.clear(); location.reload(); } if(t==='clear') { tradeHistory=[]; localStorage.setItem('oracle_history','[]'); openReport(); } } }
    </script>
</body>
</html>
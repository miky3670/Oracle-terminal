<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ORACLE TERMINAL | v87.0 REAL-MONITOR</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@stellar/stellar-sdk@12.1.0/dist/stellar-sdk.min.js"></script>
    <script src="https://sdk.minepi.com/pi-sdk.js?v=2.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --neon: #00f2ff; --bg: #050505; --panel: #0a0a0a; --buy: #39ff14; --sell: #ff4444; --hold: #ffd700; }
        body { background-color: var(--bg); color: #eee; font-family: sans-serif; margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; }
        .header-box { width: 100%; max-width: 800px; padding: 10px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #222; margin-bottom: 20px; }
        h1 { color: var(--neon); font-size: 0.8rem; letter-spacing: 3px; margin: 0; text-transform: uppercase; font-weight: 900; }
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; width: 100%; max-width: 800px; }
        .card { background: var(--panel); border: 2px solid #333; border-radius: 20px; padding: 25px 10px; display: flex; flex-direction: column; align-items: center; min-height: 220px; justify-content: space-between; }
        .coin-name { font-size: 1.1rem; font-weight: 900; color: #fff; text-transform: uppercase; letter-spacing: 2px; }
        .coin-price { font-size: 1.8rem; font-weight: 900; margin: 15px 0; font-variant-numeric: tabular-nums; transition: color 0.4s; }
        .status-row { display: flex; width: 100%; justify-content: space-between; align-items: center; gap: 6px; margin-top: 15px; }
        .indicator { background: #111; padding: 10px 2px; border-radius: 8px; font-size: 0.65rem; font-weight: 900; flex: 1; text-align: center; border: 1px solid #333; color: #eee; }
        .main-verdict { background: rgba(255,255,255,0.03); padding: 14px 2px; border-radius: 12px; font-weight: 900; font-size: 1rem; text-transform: uppercase; flex: 1.8; text-align: center; border: 1px solid #444; }
        .time-selector { display: flex; gap: 8px; margin-bottom: 20px; }
        .time-btn { background: #111; border: 1px solid #444; color: #777; padding: 8px 16px; border-radius: 6px; font-size: 0.75rem; cursor: pointer; font-weight: 900; }
        .time-btn.active { border-color: var(--neon); color: var(--neon); box-shadow: 0 0 10px rgba(0, 242, 255, 0.3); }
    </style>
</head>
<body>
    <div class="header-box">
        <h1>Oracle Terminal</h1>
        <div style="font-size:0.6rem; color:#555; font-weight:900;">v87.0 REAL-TIME ANALYSIS</div>
    </div>
    <div class="time-selector">
        <button class="time-btn" onclick="setTime('15M')">15M</button>
        <button class="time-btn active" onclick="setTime('1H')">1H</button>
        <button class="time-btn" onclick="setTime('4H')">4H</button>
        <button class="time-btn" onclick="setTime('1D')">1D</button>
    </div>
    <div id="grid" class="grid"></div>
    <script>
        const SB_URL = "https://zrbqhhnxshrayctqmncy.supabase.co";
        const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpyYnFoaG54c2hyYXljdHFtbmN5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE2ODE2MjcsImV4cCI6MjA4NzI1NzYyN30.7JA6rGog3TphPqdb3tbHz4D03haXSFWZOXwi2yK_uek";
        let selectedTF = '1H';
        let lastPrices = { BTC: 0, ETH: 0, M: 0, PI: 0 };
        let lastChanges = { BTC: 0, ETH: 0, M: 0, PI: 0 };
        let lastVols = { BTC: '0', ETH: '0', M: '0', PI: '0' };
        function setTime(tf) { selectedTF = tf; document.querySelectorAll('.time-btn').forEach(b => b.classList.toggle('active', b.innerText === tf)); updateData(); }
        function formatVol(val) { if (!val || val == 0) return '---'; if (val >= 1e9) return (val/1e9).toFixed(1) + 'B'; if (val >= 1e6) return (val/1e6).toFixed(1) + 'M'; return (val/1e3).toFixed(0) + 'K'; }
        async function updateData() {
            try {
                const resB = await fetch("https://api.binance.com/api/v3/ticker/24hr?symbols=[%22BTCUSDT%22,%22ETHUSDT%22]");
                const jsonB = await resB.json();
                jsonB.forEach(i => {
                    const s = i.symbol.replace('USDT','');
                    lastPrices[s] = parseFloat(i.lastPrice); lastChanges[s] = parseFloat(i.priceChangePercent); lastVols[s] = formatVol(parseFloat(i.quoteVolume));
                });
                const resBridge = await fetch("/api/oracle-bridge");
                const bData = await resBridge.json();
                ['PI', 'M'].forEach(s => {
                    const d = bData.find(item => item.id === s);
                    if(d && d.price) {
                        lastPrices[s] = d.price; lastChanges[s] = d.change24h || 0; lastVols[s] = formatVol(d.vol24h);
                    }
                });
                const [hRes, sRes] = await Promise.all([
                    fetch(`${SB_URL}/rest/v1/oracle_hype?select=*`, { headers: {'apikey': SB_KEY, 'Authorization': `Bearer ${SB_KEY}`} }),
                    fetch(`${SB_URL}/rest/v1/oracle_signals?select=*&timeframe=eq.${selectedTF}`, { headers: {'apikey': SB_KEY, 'Authorization': `Bearer ${SB_KEY}`} })
                ]);
                const hypes = await hRes.json();
                const signals = await sRes.json();
                let html = "";
                ['BTC', 'ETH', 'M', 'PI'].forEach(sym => {
                    const price = lastPrices[sym] || 0;
                    const trend = lastChanges[sym] || 0;
                    const db = signals.find(s => s.symbol.toUpperCase().includes(sym)) || { verdict: 'HOLD' };
                    const hScore = hypes.find(h => h.symbol.toUpperCase().includes(sym))?.score || 0;
                    const vColor = db.verdict.includes('BUY') ? 'var(--buy)' : (db.verdict.includes('SELL') ? 'var(--sell)' : 'var(--hold)');
                    html += `
                    <div class="card">
                        <span class="coin-name">${sym}</span>
                        <span class="coin-price" style="color:${trend >= 0 ? 'var(--buy)' : 'var(--sell)'}">$${price.toLocaleString(undefined, {minimumFractionDigits: (sym==='BTC'?2:4)})}</span>
                        <div class="main-verdict" style="color:${vColor}; border-color:${vColor}44">
                            ${db.verdict}<br><span style="font-size:0.6rem; color:#fff; opacity:0.6;">HYPE: ${hScore}%</span>
                        </div>
                        <div class="status-row">
                            <div class="indicator" style="color:${trend>=0?'var(--buy)':'var(--sell)'}">${trend>=0?'▲':'▼'} ${trend.toFixed(2)}%</div>
                            <div class="indicator" style="color:#888">OBJEM<br>${lastVols[sym]}</div>
                        </div>
                    </div>`;
                });
                document.getElementById('grid').innerHTML = html;
            } catch (e) { console.error(e); }
        }
        setInterval(updateData, 3000); updateData();
    </script>
</body>
</html>